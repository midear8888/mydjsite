{% extends 'users/base_a.html' %}

{% block title %}Upload{% endblock %}

{% block css %}
    <style>
        #msform {
            height: 700px;
        }
    </style>

{% endblock %}

{% block nav %}
    <li class="nav-item  mr-lg-3">
        <a class="nav-link" href="{% url 'index' %}">Home
            <span class="sr-only">(current)</span>
        </a>
    </li>
    <li class="nav-item dropdown active mr-lg-3">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
           aria-haspopup="true" aria-expanded="false">
            Data
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="{% url 'history' %}">Historys</a>
            <a class="dropdown-item" href="{% url 'gallery' %}">Gallery</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Analysis</a>
        </div>
    </li>
    <li class="nav-item dropdown mr-lg-3">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
           aria-haspopup="true" aria-expanded="false">
            Help
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="{% url 'about' %}">About</a>
            <a class="dropdown-item" href="{% url 'contact' %}">Contact</a>
            <a class="dropdown-item" href="{% url 'service' %}">Service</a>
        </div>
    </li>
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
           aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user"></i>&nbsp;&nbsp;&nbsp;Pesonal
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="{% url 'user_center' %}">Center</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">
                <i class="fas fa-power-off"></i>&nbsp;&nbsp;&nbsp;logout
            </a>
        </div>
    </li>
{% endblock %}

{% block currentname %}upload{% endblock %}

{% block content %}
    <h3>上传图片</h3>
    <div>
        <h4>选择原图</h4>
        <h3 class="fs-subtitle">上传您需要存储的心电图</h3>
            <form action="{% url 'upload' %}" method="post" enctype="multipart/form-data">
                <input type="file" name="avatar" id="avatar">
                <h4>图片相关描述</h4>
                <label>患者姓名<input /></label>
                <label>图片详细描述<input /></label>
                <input type="button" class="next action-button" value="展示原图">
            </form>
    </div>
    <div>
        <h4>原图展示</h4>
        <a href="#" id="result1"><img src="#" id="result2"></a>
    </div>
    <div>
        <h4>查看结果</h4>
        <form action="{% url 'upload' %}" method="post">
            <input type="button" class="show_result" value="显示结果">
            <a href="#" id="result3"><img src="#" id="result4"></a>
        </form>
    </div>
{% endblock %}

{% block js %}

    <script>

        $(".next").click(function () {
            var formdata=new FormData();
            formdata.append("user",$("#user").val());   {#不断的append添加键值对#}
            formdata.append("avatar",$("#avatar")[0].files[0]);
            $.ajax({
                url:"{% url 'upload' %}",
                type:"post",
                contentType:false, //加2个参数，只要有formdata就要有这两个参数。意思是不做编码了，对文件不做处理。
                processData:false,
                data:formdata,   //把整个formdata对象放到data里边
                success: function (data) {
                    console.log(data);
                    var tag1 = document.getElementById("result1");
                    var tag2 = document.getElementById("result2");
                    tag1.setAttribute("href", data);  //将src的值换成后台传过来的处理后的二值化图片的地址
                    tag2.setAttribute('src', data);
                }
            })
        });

        $(".show_result").click(function () {
            $.ajax({
                url:"{% url 'upload' %}",
                type:"post",
                data: {
                    "to_do": "1"
                },   //把整个formdata对象放到data里边
                success: function (data) {
                    console.log(data);
                    var tag1 = document.getElementById("result3");
                    var tag2 = document.getElementById("result4");
                    tag1.setAttribute("href", data);  //将src的值换成后台传过来的处理后的二值化图片的地址
                    tag2.setAttribute('src', data);
                }
            })
        });


        /*//进度条jQuery time
        var current_fs, next_fs, previous_fs; //fieldsets
        var left, opacity, scale; //fieldset properties which we will animate
        var animating; //flag to prevent quick multi-click glitches

        $(".next").click(function () {
            if (animating) return false;
            animating = true;

            current_fs = $(this).parent();
            next_fs = $(this).parent().next();

            //activate next step on progressbar using the index of next_fs
            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");

            //show the next fieldset
            next_fs.show();
            //hide the current fieldset with style
            current_fs.animate({
                opacity: 0
            }, {
                step: function (now, mx) {
                    //as the opacity of current_fs reduces to 0 - stored in "now"
                    //1. scale current_fs down to 80%
                    scale = 1 - (1 - now) * 0.2;
                    //2. bring next_fs from the right(50%)
                    left = (now * 50) + "%";
                    //3. increase opacity of next_fs to 1 as it moves in
                    opacity = 1 - now;
                    current_fs.css({
                        'transform': 'scale(' + scale + ')',
                        'position': 'absolute'
                    });
                    next_fs.css({
                        'left': left,
                        'opacity': opacity
                    });
                },
                duration: 800,
                complete: function () {
                    current_fs.hide();
                    animating = false;
                },
                //this comes from the custom easing plugin
                easing: 'easeInOutBack'
            });
        });

        $(".previous").click(function () {
            if (animating) return false;
            animating = true;

            current_fs = $(this).parent();
            previous_fs = $(this).parent().prev();

            //de-activate current step on progressbar
            $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

            //show the previous fieldset
            previous_fs.show();
            //hide the current fieldset with style
            current_fs.animate({
                opacity: 0
            }, {
                step: function (now, mx) {
                    //as the opacity of current_fs reduces to 0 - stored in "now"
                    //1. scale previous_fs from 80% to 100%
                    scale = 0.8 + (1 - now) * 0.2;
                    //2. take current_fs to the right(50%) - from 0%
                    left = ((1 - now) * 50) + "%";
                    //3. increase opacity of previous_fs to 1 as it moves in
                    opacity = 1 - now;
                    current_fs.css({
                        'left': left
                    });
                    previous_fs.css({
                        'transform': 'scale(' + scale + ')',
                        'opacity': opacity
                    });
                },
                duration: 800,
                complete: function () {
                    current_fs.hide();
                    animating = false;
                },
                //this comes from the custom easing plugin
                easing: 'easeInOutBack'
            });
        });

        $(".submit").click(function () {
            return false;
        })*/
    </script>
{% endblock %}



